# Version 2.0: Flexible Attendance & Payroll System

**Feature Name:** Flexible Attendance and Payroll System
**Version:** 2.0.0
**Status:** Planning / Not Implemented
**Target Release:** TBD
**Created:** 2026-01-03
**Last Updated:** 2026-01-03

---

## Executive Summary

This specification defines a major enhancement to the Classroom Token Hub's attendance and payroll system, making it adaptable to diverse classroom technology scenarios. Currently, the system assumes all students have device access for self-service clock-in/out. Version 2.0 introduces flexibility by allowing teachers to choose:

1. **Who tracks attendance**: Students, teachers, or both
2. **Payroll calculation method**: Time-based (current) or attendance-based (new)
3. **Hall pass behavior**: Time-pausing (time-based) or tracking-only (attendance-based)

This change supports classrooms with limited technology while maintaining the system's educational banking simulation goals.

---

## Table of Contents

1. [Problem Statement](#problem-statement)
2. [Goals & Non-Goals](#goals--non-goals)
3. [User Stories](#user-stories)
4. [Feature Components](#feature-components)
5. [Technical Requirements](#technical-requirements)
6. [Database Schema Changes](#database-schema-changes)
7. [User Interface Specifications](#user-interface-specifications)
8. [Business Logic](#business-logic)
9. [Integration Points](#integration-points)
10. [Migration Strategy](#migration-strategy)
11. [Testing Requirements](#testing-requirements)
12. [Open Questions](#open-questions)
13. [Future Enhancements](#future-enhancements)

---

## Problem Statement

### Current System Limitations

The current system requires students to:
- Have individual device access to clock in/out
- Track their own time throughout the class period
- Remember to clock out at the end of class

**This doesn't work for:**
- Classrooms without 1:1 device access
- Elementary school settings where teachers prefer centralized control
- Teachers who want salary-based compensation models
- Situations where simplicity is preferred over precision

### Why This Matters

Teachers have reported that:
- Device availability varies significantly across schools
- Younger students struggle with self-service clock-in/out
- Some prefer a simpler "present/absent" model over time tracking
- The current system creates barriers to adoption

---

## Goals & Non-Goals

### Goals

âœ… **Enable device-optional attendance tracking**
- Teachers can mark attendance on behalf of students
- Teachers can use bulk operations for efficiency

âœ… **Support attendance-based payroll**
- Flat salary per class attendance (like a real salary)
- Simpler model for younger students or less tech-savvy classrooms

âœ… **Maintain backward compatibility**
- Existing time-based systems continue to work unchanged
- Teachers can choose which model fits their classroom

âœ… **Flexible control models**
- Student-only tracking (current behavior)
- Teacher-only tracking (new)
- Hybrid mode (both can track)

âœ… **Appropriate hall pass integration**
- Time-based: Hall passes pause time (current)
- Attendance-based: Hall passes track only (new)

### Non-Goals

âŒ **Replace official school attendance systems**
- This remains an educational simulation, not official records
- Flexibility includes backdating and editing

âŒ **Complex attendance states**
- Keep status values simple (present/absent/late vs. time tracking)

âŒ **Automatic synchronization with SIS systems**
- No integration with external attendance databases

---

## User Stories

### Teacher Stories

**As a teacher with limited classroom technology:**
> I want to mark student attendance myself so that I don't need individual devices for each student.

**As a teacher of younger students:**
> I want to use a simple present/absent model so that students don't have to manage clock-in/out.

**As a teacher who wants control:**
> I want to be the only one who can mark attendance so that I ensure accurate records.

**As a teacher who wants student responsibility:**
> I want students to track their own attendance, but I want the ability to correct mistakes.

**As a teacher managing multiple periods:**
> I want to quickly mark all students present in one action so that I save time at the start of class.

**As a teacher reviewing attendance:**
> I want to see the complete attendance history with clear indicators of who created each entry.

### Student Stories

**As a student in a time-based class:**
> I want to clock in and out as I always have, so the system still feels familiar.

**As a student in an attendance-based class:**
> I want to simply check in once per class so that I don't have to remember to clock out.

**As a student whose teacher marks attendance:**
> I want to see that my teacher marked me present so that I know my payroll is correct.

**As a student who was marked incorrectly:**
> I want to notify my teacher if my attendance is wrong so they can fix it.

### System Administrator Stories

**As a system administrator:**
> I want to ensure all existing time-based classes continue working without changes.

**As a system administrator:**
> I want clear documentation on how the two payroll models differ so I can support teachers.

---

## Feature Components

### 1. Payroll Type Configuration

**Two payroll calculation models:**

#### Time-Based Payroll (Current System)
- Students clock in and out
- Pay calculated by duration: `(clock_out - clock_in) Ã— hourly_rate`
- Hall passes pause time tracking
- Attendance states: `inactive`, `start_work`, `done`

#### Attendance-Based Payroll (New)
- Students (or teachers) mark present/absent/late
- Pay calculated by attendance: `count(present) Ã— flat_rate_per_class`
- Hall passes don't affect pay, only track usage
- Attendance states: `present`, `absent`, `late`

**Configuration Location:** Payroll Settings page (existing)

**Scope:** Per `join_code` (each class period can have different settings)

---

### 2. Attendance Tracking Control

**Three control modes:**

#### Student-Only Tracking
- Students mark their own attendance (current behavior)
- Teacher can view but not modify (unless they edit logs afterward)
- Student responsibility model

#### Teacher-Only Tracking
- Only teacher can mark attendance
- Students cannot self-report
- Teacher-controlled model

#### Hybrid Tracking
- Both students and teachers can mark attendance
- Conflict resolution setting determines priority
- Flexible model for transition periods

**Configuration Location:** Payroll Settings page

**Conflict Resolution (for Hybrid mode):**
- **Last Entry Wins**: Most recent entry is used
- **Teacher Priority**: Teacher entry always overrides student entry

---

### 3. Period-Level Attendance Control

**Per-period toggles** (similar to current clock-in/out controls):

Each `TeacherBlock` (class period) has an `attendance_enabled` toggle:
- **ON**: Students can mark attendance for this period
- **OFF**: Students cannot mark attendance for this period

**Use case:** Teacher wants students to track attendance for periods 1-3, but teacher marks it for period 4 (special ed or intervention time).

**UI Location:** Attendance Management page, in the "Attendance Control" section

---

### 4. Attendance Management Interface

**Two tabs:**

#### Daily Attendance Tab
- **Visibility**: Only shown if `teacher_tracking_enabled = True`
- **Purpose**: Mark today's attendance for all students in selected period
- **Features**:
  - List of all students in the period
  - Checkboxes for bulk selection
  - Status dropdown: Present, Absent, Late (attendance-based) OR Start Work, Done (time-based)
  - "Apply to Selected" button for bulk status change
  - Individual status dropdowns per student
  - Statistics panel showing present/absent/late counts
  - Auto-save with unsaved changes warning
  - Period tabs to switch between class periods

#### Attendance Log Tab
- **Visibility**: Always shown
- **Purpose**: View and edit historical attendance records
- **Features**:
  - Searchable/filterable table of all attendance entries
  - Columns: Name, Timestamp, Status, Created By, Notes
  - Details panel when entry is selected
  - "Edit" button (disabled for system-generated hall pass entries)
  - "Delete" button (disabled for system-generated entries)
  - "Bulk Add" button to create entries for all students
  - Filtering by date range, status, period
  - Visual distinction for entries created by teacher vs. student

---

### 5. Hall Pass Integration

**Behavior depends on payroll type:**

#### Time-Based Payroll + Hall Pass
- Hall pass creation pauses time tracking (current behavior)
- Student's time stops accumulating while on hall pass
- Time resumes when hall pass is returned
- `AttendanceLog` entry created with `entry_type='hall_pass'`

#### Attendance-Based Payroll + Hall Pass
- Hall pass creation does NOT affect payroll
- Student is still marked "present" for the day
- Hall pass is tracked for accountability only
- `AttendanceLog` entry created with `entry_type='hall_pass'`

**Teacher-Initiated Hall Passes** (new):

When `student_tracking_enabled = False`:
- Students cannot initiate hall passes themselves
- Teacher must create hall pass for student:
  1. Teacher selects student from roster
  2. Teacher chooses destination
  3. Teacher starts hall pass
  4. Student can still return themselves (or teacher can return)

**NFC Tap Integration:**
- NFC taps still work for returns
- NFC taps for initiation only work if `student_tracking_enabled = True`

---

## Technical Requirements

### Performance

- Daily Attendance page must load in < 2 seconds for classes of 40 students
- Attendance Log page must support pagination for 1000+ entries
- Bulk operations (mark all present) must complete in < 1 second

### Scalability

- Support up to 200 students per teacher across all periods
- Support up to 10,000 attendance log entries per class per year
- Maintain sub-second query times for attendance reports

### Security

- All attendance queries MUST be scoped by `join_code` (multi-tenancy)
- Student names remain encrypted at rest in `AttendanceLog`
- Audit trail for all attendance modifications (who edited, when)
- CSRF protection on all attendance entry/edit forms

### Compatibility

- Works with existing time-based payroll system (no breaking changes)
- Existing `TapEvent` data preserved and continues to function
- Migration path for existing classes to opt into new features

---

## Database Schema Changes

### New Table: `AttendanceLog`

```python
class AttendanceLog(db.Model):
    __tablename__ = 'attendance_log'

    # Primary key
    id = Column(Integer, primary_key=True)

    # Multi-tenancy scoping
    student_id = Column(Integer, ForeignKey('student.id'), nullable=False)
    join_code = Column(String(6), nullable=False, index=True)

    # Attendance details
    timestamp = Column(DateTime, nullable=False, default=datetime.utcnow, index=True)
    status = Column(String(20), nullable=False)
    # Status values depend on payroll_type:
    #   - attendance_based: 'present', 'absent', 'late'
    #   - time_based: 'inactive', 'start_work', 'done'

    period = Column(String(50))  # Class period name (e.g., "Period 1", "Block A")

    # Audit trail
    created_by = Column(String(20), nullable=False)  # 'student' or 'teacher'
    modified_by = Column(String(20))  # Who last edited this entry
    modified_at = Column(DateTime)  # When last edited

    # Entry metadata
    entry_type = Column(String(20), default='manual')
    # Entry types:
    #   - 'manual': User-created entry
    #   - 'hall_pass': System-generated from hall pass
    #   - 'clock': System-generated from clock-in/out

    is_system_generated = Column(Boolean, default=False)
    # True for hall_pass entries - these cannot be edited/deleted

    notes = Column(Text)  # Optional notes from teacher

    # Relationships
    student = relationship('Student', backref='attendance_logs')

    # Indexes for common queries
    __table_args__ = (
        Index('ix_attendance_join_code_timestamp', 'join_code', 'timestamp'),
        Index('ix_attendance_student_join_code', 'student_id', 'join_code'),
    )
```

### Modified Table: `PayrollSettings`

```python
class PayrollSettings(db.Model):
    # ... existing fields ...

    # NEW FIELDS FOR V2.0

    # Payroll calculation method
    payroll_type = Column(String(20), default='time_based')
    # Values: 'time_based', 'attendance_based'

    # Attendance-based payroll configuration
    attendance_flat_rate = Column(Numeric(10, 2), default=0.00)
    # Amount paid per 'present' attendance (only used if payroll_type='attendance_based')

    # Tracking control
    student_tracking_enabled = Column(Boolean, default=True)
    # If True, students can mark their own attendance/clock in

    teacher_tracking_enabled = Column(Boolean, default=False)
    # If True, teacher can mark attendance via Daily Attendance interface

    # Conflict resolution (only used if both student and teacher tracking are enabled)
    conflict_resolution = Column(String(20), default='last_entry')
    # Values: 'last_entry', 'teacher_priority'
```

### Modified Table: `TeacherBlock`

```python
class TeacherBlock(db.Model):
    # ... existing fields ...

    # NEW FIELD FOR V2.0

    # Per-period attendance control
    attendance_enabled = Column(Boolean, default=True)
    # If True, students can mark attendance for this specific period
    # If False, only teacher can mark attendance (overrides student_tracking_enabled)
```

### Migration Considerations

**Backward Compatibility:**
- All new fields have defaults that maintain current behavior
- `payroll_type` defaults to `'time_based'` (current system)
- `student_tracking_enabled` defaults to `True` (current system)
- `teacher_tracking_enabled` defaults to `False` (no change)
- `attendance_enabled` defaults to `True` (current system)

**Data Migration:**
- No need to backfill `AttendanceLog` from `TapEvent` data
- `TapEvent` table remains for historical time-based tracking
- New system runs in parallel with old system

**Migration Script:**
```bash
flask db migrate -m "Add attendance_based payroll system and AttendanceLog model"
flask db upgrade
```

---

## User Interface Specifications

### 1. Payroll Settings Page (Modified)

**Location:** Settings â†’ Payroll Settings

**New Section: "Attendance & Payroll Configuration"**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Attendance & Payroll Configuration                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ Payroll Calculation Method:                         â”‚
â”‚ â—‹ Time-Based                                        â”‚
â”‚   Students clock in/out, paid by hours worked       â”‚
â”‚                                                      â”‚
â”‚ â—‹ Attendance-Based                                  â”‚
â”‚   Students marked present/absent, paid per class    â”‚
â”‚   Flat rate per class: $[____]                     â”‚
â”‚                                                      â”‚
â”‚ Who Can Track Attendance:                           â”‚
â”‚ â˜ Students can mark their own attendance            â”‚
â”‚ â˜ Teachers can mark student attendance              â”‚
â”‚                                                      â”‚
â”‚ If both enabled:                                    â”‚
â”‚ Conflict Resolution:                                â”‚
â”‚ â—‹ Last entry wins                                   â”‚
â”‚ â—‹ Teacher entry always wins                         â”‚
â”‚                                                      â”‚
â”‚ [Save Settings]                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Validation Rules:**
- If "Attendance-Based" is selected, "Flat rate per class" is required
- At least one tracking method must be enabled
- Conflict resolution only shown if both tracking methods enabled

**Help Text:**
- Time-Based: "Students track exact time worked. Best for classrooms with individual devices."
- Attendance-Based: "Students receive flat pay for being present. Best for classrooms with limited technology."

---

### 2. Attendance Management Page (New)

**Location:** Main Navigation â†’ Attendance (new menu item, only shown if `teacher_tracking_enabled = True`)

**Layout:** See wireframe provided by user

#### Daily Attendance Tab

**Header:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Period 1] [Period 2] [Period 3]                    â”‚
â”‚                                                       â”‚
â”‚  Date: January 3, 2026 (today, not editable)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Attendance Control Section:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Attendance Control                                   â”‚
â”‚                                                       â”‚
â”‚  Period 1:  [On] [Off]                              â”‚
â”‚  Period 2:  [On] [Off]                              â”‚
â”‚  Period 3:  [On] [Off]                              â”‚
â”‚                                                       â”‚
â”‚  (Controls whether students can self-report for      â”‚
â”‚   this specific period)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Student Roster:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜  Name              Attendance                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜  Alice Smith       [Present â–¼]                     â”‚
â”‚ â˜  Bob Jones         [Absent  â–¼]                     â”‚
â”‚ â˜  Carol Williams    [Late    â–¼]                     â”‚
â”‚ â˜  Dave Brown        [Present â–¼]                     â”‚
â”‚ ...                                                   â”‚
â”‚                                                       â”‚
â”‚ [Apply to Selected â–¼] [Absent] [Present] [Late]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Statistics Panel:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Statistics                                           â”‚
â”‚                                                       â”‚
â”‚ Present: 23                                          â”‚
â”‚ Absent:  2                                           â”‚
â”‚ Late:    1                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Save Behavior:**
- Auto-save after each change
- Warning dialog if navigating away with unsaved changes
- Visual indicator of unsaved changes (if any)

---

#### Attendance Log Tab

**Header:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Filters:                                            â”‚
â”‚  Date: [From: ___] [To: ___]                        â”‚
â”‚  Period: [All Periods â–¼]                            â”‚
â”‚  Status: [All Statuses â–¼]                           â”‚
â”‚  Created By: [All â–¼]                                â”‚
â”‚  [Apply Filters]  [Clear]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Log Table:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name         Date/Time           Status    Created By   Actions  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Alice Smith  Jan 3, 10:45 AM    Present   Teacher      [Edit]    â”‚
â”‚ Bob Jones    Jan 3, 10:46 AM    Absent    Teacher      [Edit]    â”‚
â”‚ Alice Smith  Jan 2, 2:15 PM     ðŸšª Hall   System       [ðŸ”’]      â”‚
â”‚              (Hall Pass)         Pass                            â”‚
â”‚ Carol Will.  Jan 2, 10:40 AM    Present   Student      [Edit]    â”‚
â”‚ ...                                                               â”‚
â”‚                                                                   â”‚
â”‚ Showing 1-20 of 243            [Previous] [Next]                â”‚
â”‚                                                                   â”‚
â”‚ [Bulk Add Log Entry]                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Details Panel** (appears when entry selected):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Details                                              â”‚
â”‚                                                       â”‚
â”‚ Name: Alice Smith                                    â”‚
â”‚ Timestamp: Jan 3, 2026 10:45 AM                     â”‚
â”‚ Status: Present                                      â”‚
â”‚ Period: Period 1                                     â”‚
â”‚ Created by: Teacher                                  â”‚
â”‚ Modified by: Teacher (Jan 3, 10:50 AM)              â”‚
â”‚ Notes: [empty]                                       â”‚
â”‚                                                       â”‚
â”‚ [Edit] [Delete]                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Hall Pass Entry** (system-generated, cannot edit):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Details                                              â”‚
â”‚                                                       â”‚
â”‚ Name: Alice Smith                                    â”‚
â”‚ Timestamp: Jan 2, 2026 2:15 PM                      â”‚
â”‚ Status: Hall Pass                                    â”‚
â”‚ Period: Period 1                                     â”‚
â”‚ Created by: System (Hall Pass)                       â”‚
â”‚ Entry Type: System-Generated                         â”‚
â”‚                                                       â”‚
â”‚ ðŸ”’ System-generated entries cannot be edited         â”‚
â”‚                                                       â”‚
â”‚ [Close]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Edit Log Entry Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edit Log Entry                               [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚ â˜‘ Timestamp   [1/3/2026] [ðŸ“…]  [10:45 AM]          â”‚
â”‚ â˜ Status      [Present â–¼]                           â”‚
â”‚                                                       â”‚
â”‚ Notes:                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚                                               â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                       â”‚
â”‚               [Cancel]  [Update]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Confirmation Dialog (if editing affects unpaid payroll):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Confirm Edit Log Entry                       [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚ You are about to update the log entry for 1 student. â”‚
â”‚                                                       â”‚
â”‚ âš ï¸ This entry is part of unpaid payroll.            â”‚
â”‚ Student payroll calculations may be impacted.        â”‚
â”‚                                                       â”‚
â”‚               [Cancel]  [Edit]  [Confirm]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. Bulk Add Log Entry Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bulk Add Log Entry                           [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚ Class Period:  [Period 1 â–¼]                         â”‚
â”‚ Timestamp:     [1/3/2026] [ðŸ“…]  [10:45 AM]         â”‚
â”‚ Status:        [Present â–¼]                           â”‚
â”‚                                                       â”‚
â”‚ This will create an entry for ALL students in       â”‚
â”‚ the selected period.                                 â”‚
â”‚                                                       â”‚
â”‚               [Cancel]  [Add]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. Student View Changes

#### Clock-In Page (Modified)

**If `student_tracking_enabled = False` for current period:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Attendance                                           â”‚
â”‚                                                       â”‚
â”‚ ðŸ“‹ Your teacher is managing attendance for this     â”‚
â”‚     class period.                                    â”‚
â”‚                                                       â”‚
â”‚ No action needed from you.                           â”‚
â”‚                                                       â”‚
â”‚ Current Status: [Present] âœ“                         â”‚
â”‚ (Marked by teacher at 10:45 AM)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**If `payroll_type = 'attendance_based'` and `student_tracking_enabled = True`:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check In                                             â”‚
â”‚                                                       â”‚
â”‚ Click below to mark yourself present for today's    â”‚
â”‚ class.                                               â”‚
â”‚                                                       â”‚
â”‚        [âœ“ I'm Present]                              â”‚
â”‚                                                       â”‚
â”‚ Current Status: Not Checked In                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**After checking in (attendance-based):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Attendance                                           â”‚
â”‚                                                       â”‚
â”‚ âœ“ You're marked present for today's class!         â”‚
â”‚                                                       â”‚
â”‚ Checked in at: 10:45 AM                             â”‚
â”‚                                                       â”‚
â”‚ No need to check out - you're all set!             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Business Logic

### Attendance Entry Creation

**Function:** `create_attendance_entry(student_id, join_code, status, created_by, period, timestamp=None, notes=None)`

**Logic:**
1. Check if entry exists for same student, join_code, period, and date
2. If exists and `conflict_resolution = 'teacher_priority'`:
   - If new entry is from teacher: overwrite
   - If new entry is from student and existing is from teacher: reject
   - If new entry is from student and existing is from student: overwrite
3. If exists and `conflict_resolution = 'last_entry'`:
   - Always overwrite with new entry
4. If not exists: create new entry
5. Return created/updated entry

**Pseudo-code:**
```python
def create_attendance_entry(student_id, join_code, status, created_by, period, timestamp=None, notes=None):
    if timestamp is None:
        timestamp = datetime.utcnow()

    # Scope by join_code (multi-tenancy!)
    existing = AttendanceLog.query.filter_by(
        student_id=student_id,
        join_code=join_code,
        period=period
    ).filter(
        func.date(AttendanceLog.timestamp) == func.date(timestamp)
    ).first()

    payroll_settings = PayrollSettings.query.filter_by(join_code=join_code).first()

    if existing:
        # Handle conflict resolution
        if payroll_settings.conflict_resolution == 'teacher_priority':
            if created_by == 'student' and existing.created_by == 'teacher':
                raise ConflictError("Teacher entry takes priority")

        # Update existing entry
        existing.status = status
        existing.modified_by = created_by
        existing.modified_at = datetime.utcnow()
        existing.notes = notes
        db.session.commit()
        return existing
    else:
        # Create new entry
        entry = AttendanceLog(
            student_id=student_id,
            join_code=join_code,
            timestamp=timestamp,
            status=status,
            period=period,
            created_by=created_by,
            notes=notes
        )
        db.session.add(entry)
        db.session.commit()
        return entry
```

---

### Payroll Calculation

**Modified Function:** `calculate_payroll(student_id, join_code, pay_period_start, pay_period_end)`

**Logic:**
1. Get `PayrollSettings` for `join_code`
2. If `payroll_type == 'time_based'`:
   - Use existing time-based calculation (TapEvent data)
3. If `payroll_type == 'attendance_based'`:
   - Query `AttendanceLog` for 'present' statuses in date range
   - Count number of 'present' entries
   - Multiply by `attendance_flat_rate`
   - Return total

**Pseudo-code:**
```python
def calculate_payroll(student_id, join_code, pay_period_start, pay_period_end):
    payroll_settings = PayrollSettings.query.filter_by(join_code=join_code).first()

    if payroll_settings.payroll_type == 'time_based':
        # Existing time-based calculation
        return calculate_time_based_payroll(student_id, join_code, pay_period_start, pay_period_end)

    elif payroll_settings.payroll_type == 'attendance_based':
        # New attendance-based calculation
        present_count = AttendanceLog.query.filter_by(
            student_id=student_id,
            join_code=join_code,
            status='present'
        ).filter(
            AttendanceLog.timestamp >= pay_period_start,
            AttendanceLog.timestamp <= pay_period_end
        ).count()

        total_pay = present_count * payroll_settings.attendance_flat_rate

        return {
            'student_id': student_id,
            'total_pay': total_pay,
            'days_present': present_count,
            'rate_per_day': payroll_settings.attendance_flat_rate,
            'payroll_type': 'attendance_based'
        }
```

---

### Hall Pass Creation

**Modified Function:** `create_hall_pass(student_id, join_code, destination, created_by)`

**Additional Logic for Attendance-Based:**
1. Create hall pass as normal
2. If `payroll_type == 'attendance_based'`:
   - Do NOT pause time tracking (there is no time tracking)
   - Create `AttendanceLog` entry with `entry_type='hall_pass'`, `is_system_generated=True`
3. If `payroll_type == 'time_based'`:
   - Pause time tracking (existing behavior)
   - Create `AttendanceLog` entry with `entry_type='hall_pass'`, `is_system_generated=True`

**Teacher-Initiated Hall Pass:**
1. Teacher selects student from roster
2. Teacher selects destination
3. System creates hall pass with `created_by='teacher'`
4. Student receives notification (if applicable)
5. Student can still return themselves, or teacher can return

---

### Backdating and Payroll Impact

**When editing an attendance entry:**
1. Determine if entry timestamp falls within an unpaid payroll period
2. If yes: Show warning dialog "This may affect unpaid payroll"
3. If no (already paid out): Allow edit without warning
4. Update entry timestamp and/or status
5. Mark entry as `modified_by` with current timestamp

**Determining if payroll is paid:**
- Query `Transaction` table for payroll transactions
- Check if a payroll transaction exists for the student in the period containing the edited entry's timestamp
- If exists: Entry is in a paid period
- If not exists: Entry is in an unpaid period

---

## Integration Points

### 1. Existing Clock-In/Out System

**Integration:**
- If `payroll_type = 'time_based'`: Existing system continues unchanged
- If `student_tracking_enabled = False`: Hide clock-in UI from students
- If `attendance_enabled = False` for a specific period: Hide clock-in for that period only

**Backward Compatibility:**
- `TapEvent` table remains unchanged
- Time-based payroll calculation uses `TapEvent` data (not `AttendanceLog`)
- No migration of historical `TapEvent` data required

---

### 2. Hall Pass System

**Integration:**
- All hall pass events create `AttendanceLog` entries with `entry_type='hall_pass'`
- These entries are `is_system_generated=True` and cannot be edited/deleted
- If `payroll_type = 'time_based'`: Hall pass pauses time (existing behavior)
- If `payroll_type = 'attendance_based'`: Hall pass does NOT affect pay (new behavior)

**Teacher-Initiated Hall Pass:**
- New UI in hall pass interface for teacher to select student and create pass
- Only available if `student_tracking_enabled = False`
- Student can still return hall pass themselves (or teacher can return)

---

### 3. Payroll Processing

**Integration:**
- Modify `app/payroll.py` to check `payroll_type` before calculation
- Route to appropriate calculation function
- Payroll reports show different columns based on type:
  - Time-based: Hours worked, Hourly rate, Total
  - Attendance-based: Days present, Rate per day, Total

**Migration:**
- Teachers switching from time-based to attendance-based mid-year will have mixed payroll history
- Reports should clearly indicate which calculation method was used for each pay period

---

### 4. Reporting

**Integration:**
- Add attendance reports to existing reporting system
- Attendance summary by period
- Attendance trends over time
- Hall pass usage reports (even in attendance-based mode)

**New Report Types:**
- **Daily Attendance Summary**: Present/Absent/Late counts per day
- **Student Attendance History**: Individual student's attendance over date range
- **Period Comparison**: Compare attendance rates across different class periods
- **Attendance vs. Payroll**: Show correlation between attendance and earnings

---

## Migration Strategy

### Phase 1: Database Schema (PR #1)
- Create migration for `AttendanceLog` table
- Add fields to `PayrollSettings`
- Add field to `TeacherBlock`
- Run migration on dev/staging
- Test rollback

**Deliverables:**
- Migration script
- Updated `models.py`
- Database schema documentation update

---

### Phase 2: Settings UI (PR #2)
- Add payroll type selection to Payroll Settings page
- Add tracking control toggles
- Add conflict resolution setting
- Add attendance flat rate field (conditional visibility)
- Form validation and help text

**Deliverables:**
- Updated Payroll Settings template
- Updated forms
- Settings save/load logic
- Tests for settings CRUD

---

### Phase 3: Attendance Utilities (PR #3)
- Create `app/utils/attendance_utils.py`
- Implement attendance entry creation logic
- Implement conflict resolution logic
- Implement backdating validation
- Implement payroll impact checking

**Deliverables:**
- `attendance_utils.py` with core functions
- Unit tests for all utility functions
- Documentation of utility functions

---

### Phase 4: Daily Attendance Interface (PR #4)
- Create Attendance Management page
- Implement Daily Attendance tab
- Period selector tabs
- Attendance Control toggles (per-period)
- Student roster with status dropdowns
- Bulk "Apply to Selected" functionality
- Statistics panel
- Auto-save functionality

**Deliverables:**
- `templates/attendance/management.html`
- `templates/attendance/daily_tab.html`
- New routes in `app/routes/attendance.py`
- Forms for attendance entry
- Tests for daily attendance routes

---

### Phase 5: Attendance Log Interface (PR #5)
- Implement Attendance Log tab
- Filterable/searchable log table
- Details panel
- Edit modal
- Delete functionality (with restrictions)
- Bulk Add modal
- Pagination

**Deliverables:**
- `templates/attendance/log_tab.html`
- Edit/Delete routes
- Bulk add route
- Tests for log viewing and editing

---

### Phase 6: Payroll Calculation Update (PR #6)
- Modify `app/payroll.py` to handle both payroll types
- Implement attendance-based calculation
- Update payroll reports to show relevant data per type
- Test mixed payroll scenarios (switching mid-year)

**Deliverables:**
- Updated `payroll.py`
- Updated payroll report templates
- Tests for both calculation methods
- Tests for mixed payroll scenarios

---

### Phase 7: Hall Pass Integration (PR #7)
- Modify hall pass creation to check payroll type
- Implement attendance-based hall pass behavior (no time pause)
- Create `AttendanceLog` entries for hall pass events
- Implement teacher-initiated hall pass UI and logic
- Update hall pass return flow

**Deliverables:**
- Updated hall pass routes
- Updated hall pass templates (teacher-initiated UI)
- `AttendanceLog` creation in hall pass flow
- Tests for hall pass + attendance integration

---

### Phase 8: Student UI Updates (PR #8)
- Update clock-in/out pages based on settings
- Hide clock-in if `student_tracking_enabled = False`
- Implement attendance-based check-in UI
- Show status (marked by teacher vs. self-reported)
- Update student dashboard to reflect attendance status

**Deliverables:**
- Updated student clock-in templates
- New attendance check-in template
- Updated student dashboard
- Tests for student attendance views

---

### Phase 9: Reporting & Analytics (PR #9)
- Create daily attendance summary report
- Create student attendance history report
- Create period comparison report
- Create attendance vs. payroll correlation report
- Export functionality

**Deliverables:**
- New report templates
- Report routes
- CSV export functionality
- Tests for all report types

---

### Phase 10: Documentation & Polish (PR #10)
- Update CHANGELOG.md for v2.0.0
- Update user guides (teacher and student)
- Update technical documentation
- Update database schema docs
- Add migration guide for teachers
- Polish UI/UX based on testing feedback

**Deliverables:**
- Updated documentation across `docs/`
- Migration guide for teachers (how to switch to attendance-based)
- Release notes
- Final QA and bug fixes

---

## Testing Requirements

### Unit Tests

**Attendance Entry Creation:**
- Test creating new entry
- Test updating existing entry
- Test conflict resolution (last_entry)
- Test conflict resolution (teacher_priority)
- Test backdating

**Payroll Calculation:**
- Test time-based calculation (existing)
- Test attendance-based calculation
- Test mixed payroll (switching mid-year)
- Test with various attendance patterns

**Hall Pass Integration:**
- Test hall pass creation in time-based mode
- Test hall pass creation in attendance-based mode
- Test teacher-initiated hall pass
- Test `AttendanceLog` entry creation

---

### Integration Tests

**Settings Configuration:**
- Test saving payroll type
- Test saving tracking controls
- Test saving conflict resolution
- Test validation rules

**Daily Attendance:**
- Test bulk marking students present
- Test individual status changes
- Test period switching
- Test auto-save

**Attendance Log:**
- Test viewing log
- Test filtering/searching
- Test editing entries
- Test deleting entries
- Test bulk add

**Payroll Processing:**
- Test end-to-end payroll run (time-based)
- Test end-to-end payroll run (attendance-based)
- Test payroll with mixed entries

---

### Multi-Tenancy Tests

**Critical Tests (MUST PASS):**
- Attendance entries scoped by `join_code`
- Teacher can only see students in their class periods
- Student can only see their own attendance in current period
- Bulk operations only affect students in selected period
- Payroll calculation only includes entries for specific `join_code`

---

### Regression Tests

**Ensure No Breaking Changes:**
- Existing time-based payroll continues to work
- Existing clock-in/out UI still functions
- Existing hall pass system still functions
- Existing reports still generate correctly
- Existing `TapEvent` data is preserved

---

## Open Questions

### 1. Late Arrival / Early Departure

**Question:** For attendance-based payroll, should "Late" status result in reduced pay?

**Options:**
- A) "Late" = full pay (same as "Present")
- B) "Late" = partial pay (e.g., 50% of flat rate)
- C) Configurable by teacher

**Recommendation:** Start with Option A (Late = full pay), add Option C in future if requested.

---

### 2. Multiple Check-Ins Per Day

**Question:** What happens if a student checks in multiple times in one day for the same period?

**Options:**
- A) Only first check-in counts
- B) Only last check-in counts
- C) Teacher gets notified of duplicate
- D) System prevents duplicate check-in

**Recommendation:** Option D (prevent duplicate), with clear message "You've already checked in for today."

---

### 3. Attendance Streaks / Gamification

**Question:** Should the system track attendance streaks or perfect attendance?

**Options:**
- A) Not in v2.0 (keep it simple)
- B) Add streak tracking and badges
- C) Add stats but no badges

**Recommendation:** Option A for v2.0, consider for v2.1 based on teacher feedback.

---

### 4. Teacher Bulk Sign-In Options

**Question:** Should bulk sign-in have additional options?

**Options:**
- A) Simple "Mark All Present" button
- B) Remember typical attendance pattern (auto-populate common absences)
- C) Quick checkboxes (all on by default, uncheck absences)

**Recommendation:** Option C (checkboxes with all selected by default) is most flexible.

---

### 5. Notification When Teacher Marks Attendance

**Question:** Should students be notified when teacher marks them present/absent?

**Options:**
- A) No notifications
- B) Email/SMS notification
- C) In-app notification when student next logs in
- D) Optional (teacher chooses)

**Recommendation:** Option C for v2.0 (in-app notification), Option D for future.

---

### 6. Attendance Appeals

**Question:** What if a student disagrees with teacher's attendance marking?

**Options:**
- A) Student can message teacher (use existing messaging system)
- B) Student can request correction (new feature)
- C) Student can submit evidence (photo, note)
- D) No formal process

**Recommendation:** Option A for v2.0 (use existing communication), consider Option B for v2.1.

---

### 7. Period vs. Class vs. Block Naming

**Question:** Should periods be called "Period 1", "Block A", "Class Section", etc.?

**Options:**
- A) Fixed naming: "Period 1", "Period 2", etc.
- B) Teacher-customizable names
- C) Both (default names with option to rename)

**Recommendation:** Option B (teacher-customizable) for flexibility.

---

## Future Enhancements (Beyond v2.0)

### v2.1 Potential Features

- **Attendance streaks and perfect attendance badges**
- **Automated attendance reminders** (remind teacher to take attendance if not done by X time)
- **Attendance patterns** (pre-populate based on historical data)
- **Student attendance appeals** (formal process to dispute marking)
- **Parent/guardian attendance view** (if parent portal is added)
- **Integration with school calendars** (auto-mark holidays, no-school days)
- **Attendance-based bonuses** (perfect attendance bonus pay)

### v3.0 Potential Features

- **QR code attendance** (students scan QR code to check in)
- **Geofencing** (students can only check in if physically in classroom)
- **Biometric attendance** (fingerprint or face recognition)
- **Synchronization with SIS** (export attendance to school systems)
- **Advanced analytics** (predictive models for attendance patterns)
- **Multi-period attendance scheduling** (different rates for different periods)

---

## Success Metrics

### Adoption Metrics

- **% of teachers enabling attendance-based payroll** (target: >20% within 3 months)
- **% of teachers enabling teacher tracking** (target: >30% within 3 months)
- **Average time to take daily attendance** (target: <2 minutes for 30 students)

### Performance Metrics

- **Daily Attendance page load time** (target: <2 seconds)
- **Attendance Log query time** (target: <1 second for 1000 entries)
- **Bulk add completion time** (target: <1 second for 40 students)

### Quality Metrics

- **Bug reports related to attendance** (target: <5 per month after initial release)
- **Support tickets related to payroll confusion** (target: <10 per month)
- **Data leakage incidents** (target: 0 - must maintain multi-tenancy)

### User Satisfaction

- **Teacher satisfaction with flexibility** (target: >4.5/5 in survey)
- **Student understanding of new system** (target: >80% comprehension)
- **Reduction in payroll disputes** (target: 30% reduction compared to v1.x)

---

## Appendix

### Terminology

- **Attendance-Based Payroll**: Payroll calculated by counting days present, not time worked
- **Time-Based Payroll**: Payroll calculated by total hours worked (current system)
- **Join Code**: Unique identifier for a class period (multi-tenancy key)
- **Period**: A class period (e.g., "Period 1", "Block A")
- **Conflict Resolution**: How the system handles duplicate attendance entries
- **System-Generated Entry**: Attendance entry created automatically (e.g., from hall pass)
- **Manual Entry**: Attendance entry created by user (teacher or student)

### Related Documents

- `.claude/rules/multi-tenancy.md` - Multi-tenancy scoping rules
- `.claude/rules/database-migrations.md` - Database migration workflow
- `.claude/rules/testing.md` - Testing requirements
- `docs/technical-reference/database_schema.md` - Current database schema
- `docs/user-guides/teacher_manual.md` - Teacher documentation (to be updated)

### Revision History

| Date       | Version | Author | Changes                      |
|------------|---------|--------|------------------------------|
| 2026-01-03 | 1.0     | Claude | Initial specification        |

---

**Document Status:** Draft / In Review
**Approvals Required:** Product Owner, Lead Developer, QA Lead
**Target Implementation Start:** TBD
**Target Release Date:** TBD
